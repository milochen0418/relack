# Testing Guide

This directory contains automated test suites for the Relack application.

## Running Tests

We provide a helper script `run_test_suite.sh` in the project root to automate the testing process. This script handles:
1. Cleaning up old Reflex processes.
2. Starting a fresh Reflex server instance.
3. Waiting for the server to be ready.
4. Running the specified test script.
5. Cleaning up afterwards.

### Usage

Run the default test suite (guest_login):
```bash
./run_test_suite.sh
```

Run a specific test suite:
```bash
./run_test_suite.sh <suite_name>
```

Example:
```bash
./run_test_suite.sh guest_login
```

## Adding a New Test Case

To add a new test suite, follow these steps:

1.  **Create a Directory**: Create a new folder inside `testcases/` with your suite name.
    ```bash
    mkdir testcases/my_feature
    ```

2.  **Create the Test Script**: Inside your new folder, create a file named `run_test.py`.
    ```bash
    touch testcases/my_feature/run_test.py
    ```

3.  **Write the Test**: Implement your test logic using Playwright.
    - The script should define a `run()` function or just run on execution.
    - If you need to save screenshots or logs, save them to an `output` directory relative to your script. The runner automatically creates this directory.

    **Template for `run_test.py`**:
    ```python
    from playwright.sync_api import sync_playwright
    import os
    import sys

    def run():
        # Setup output directory for artifacts
        output_dir = os.path.join(os.path.dirname(__file__), "output")
        os.makedirs(output_dir, exist_ok=True)

        with sync_playwright() as p:
            browser = p.chromium.launch()
            page = browser.new_page()
            
            try:
                # Your test logic here
                page.goto("http://localhost:3000")
                
                # Example assertion
                if "Relack" not in page.title():
                    raise Exception("Wrong title")
                    
                print("Test passed!")
                
            except Exception as e:
                print(f"Test failed: {e}")
                # Save failure screenshot
                page.screenshot(path=os.path.join(output_dir, "failure.png"))
                sys.exit(1)
            finally:
                browser.close()

    if __name__ == "__main__":
        run()
    ```

4.  **Run Your Test**:
    ```bash
    ./run_test_suite.sh my_feature
    ```

## Test Artifacts

Test logs (Reflex server logs) and any artifacts generated by your test script (like screenshots) will be stored in:
`testcases/<suite_name>/output/`

This directory is ignored by git.
